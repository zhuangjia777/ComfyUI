1. æ¿€æ´»çŽ¯å¢ƒ

conda activate ./my_env
2. è¿è¡Œä¸»ç¨‹åº
python main.py --listen 0.0.0.0 --port 8189 --enable-cors-header

3. æ‰“å¼€æµè§ˆå™¨è¾“å…¥ç½‘å€
æœ¬æœº
http://127.0.0.1:8189
å±€åŸŸç½‘
http://192.168.110.2:8189


4. å¦‚æžœè¦åŽå°è¿è¡Œ
# åˆ›å»ºæ–°çš„screenä¼šè¯
screen -S comfyui

# åœ¨screenä¼šè¯ä¸­è¿è¡Œç¨‹åº
æ¿€æ´»çŽ¯å¢ƒ
conda activate ./my_env
python main.py --listen 0.0.0.0 --port 8189 --enable-cors-header

# æŒ‰Ctrl+Aï¼Œç„¶åŽæŒ‰Dé”®å¯ä»¥ detach ä¼šè¯ï¼Œç¨‹åºä¼šåœ¨åŽå°ç»§ç»­è¿è¡Œ
# é‡æ–°è¿žæŽ¥ä¼šè¯
screen -r comfyui

# æŸ¥æ‰¾å¹¶ç»“æŸå ç”¨ç«¯å£çš„è¿›ç¨‹
# æŸ¥æ‰¾å ç”¨8188ç«¯å£çš„è¿›ç¨‹
lsof -i :8189

# å¦‚æžœä¸Šé¢çš„å‘½ä»¤æ²¡æœ‰è¿”å›žç»“æžœï¼Œå°è¯•è¿™ä¸ª
netstat -tuln | grep 8189

# æ‰¾åˆ°è¿›ç¨‹IDï¼ˆPIDï¼‰åŽï¼Œä½¿ç”¨killå‘½ä»¤ç»“æŸå®ƒ
kill -9 [PID]

5. å±€åŸŸç½‘å¼€æ”¾æœ¬æœºç«¯å£
```bash
sudo ufw status
sudo ufw enable  # å¦‚æžœæœªå¯ç”¨ï¼Œå…ˆå¯ç”¨

sudo ufw allow 8189/tcp
sudo ufw reload  # é‡æ–°åŠ è½½é˜²ç«å¢™è§„åˆ™
```

æ³¨æ„
1. å¦‚æžœæ²¡æœ‰é¡¹ç›®ä¸­æ²¡æœ‰my_envæ–‡ä»¶å¤¹ï¼Œå…ˆåˆ›å»ºç‹¬ç«‹çŽ¯å¢ƒ
```cmd
conda create -p ./my_env python=3.12.4
```
2. åœ¨custom_nodesç›®å½•ä¸­
git clone https://github.com/MrForExample/ComfyUI-3D-Pack.git

3. cd ComfyUI-3D-Pack
pip install -r requirements.txt
python ./install.py

4. å›žåˆ°é¡¹ç›®æ ¹ç›®å½•
pip install -r requirements.txt

5. å¦‚æžœtorchå‡ºé”™ï¼Œä¿®æ­£æŸ¥æ‰¾pytorch3då’Œtorchèƒ½å¯¹åº”çš„ç‰ˆæœ¬:
https://anaconda.org/pytorch3d/pytorch3d/files?page=2
https://data.pyg.org/whl/
å…¼å®¹comfyui-3d-packçš„torchç‰ˆæœ¬ï¼štorch241+cuda121
1. å®‰è£…å››ä»¶å¥—ï¼špip install torch==2.4.1 torchvision torchaudio xformers --extra-index-url https://download.pytorch.org/whl/cu121
2. å®‰è£…é¡¹ç›®æ ¹ç›®å½•ä¸­çš„pytorch3dï¼š conda install ./pytorch3d-0.7.8-py312_cu121_pyt241.tar.bz2
3. å®‰è£…é¡¹ç›®æ ¹ç›®å½•ä¸­çš„torch_scatter: pip install ./torch_scatter

6. æ¨¡åž‹ä¸‹è½½æºæ›¿æ¢
# åœ¨main.pyä¸­é¡¶éƒ¨æ·»åŠ HuggingFaceé•œåƒä»£ç 
import requests
from urllib.parse import urlparse

original_request = requests.Session.request

def patched_request(self, method, url, **kwargs):
    parsed = urlparse(url)
    if parsed.netloc == "huggingface.co":
        url = url.replace("huggingface.co", "hf-mirror.com")
    return original_request(self, method, url, **kwargs)

requests.Session.request = patched_request

import comfy.options
comfy.options.enable_args_parsing()
# ==========æ·»åŠ ç»“æŸ===========

7. comfyui-copilot
zhuangjia777@foxmail.com
a13df43df87542dbad6f61d460452294

8. ä¿®å¤æŠ¥é”™comfyUI-3D-Pack
ImportError: cannot import name '_load_state_dict_into_model' from 'diffusers.models.modeling_utils' (/home/ck/myProjects/ComfyUI-3D/my_env/lib/python3.12/site-packages/diffusers/models/modeling_utils.py)
ä¿®å¤æ–¹æ¡ˆï¼š
# from diffusers.models.modeling_utils import ModelMixin, load_state_dict, _load_state_dict_into_model
from diffusers.models.modeling_utils import ModelMixin, load_state_dict

# error_msgs = _load_state_dict_into_model(model_to_load, state_dict)
error_msgs = model_to_load.load_state_dict(state_dict, strict=False)


10. å¦‚æžœå‡ºçŽ°æŠ¥é”™ï¼š
# ðŸ˜ºdzNodes: LayerStyle -> Cannot import name 'guidedFilter' from 'cv2.ximgproc'
A few nodes cannot works properly, while most nodes are not affected. Please REINSTALL package 'opencv-contrib-python'.
è§£å†³æ–¹æ¡ˆï¼š
```
pip uninstall -y opencv-python opencv-python-headless opencv-contrib-python-headless opencv-contrib-python
pip install opencv-python opencv-python-headless opencv-contrib-python-headless
pip install opencv-contrib-python
```

9. å¦‚æžœå‡ºçŽ°æŠ¥é”™ï¼š
Optional node movie_editor import failed with error: No module named 'moviepy.editor'.If you don't need to use this optional node, this reminder can be ignored.â€‹
è§£å†³æ–¹æ¡ˆï¼šä¿®æ”¹ComfyUI_llm_party/custom_tool/moive_editorçš„å¯¼å…¥
```
# from moviepy.editor import *
from moviepy import VideoFileClip, AudioFileClip, ImageClip, concatenate_videoclips
```